// src/i18n.ts
import { reactive } from 'vue';
import { getPreferredLocale } from './utils/locale';

const messages: Record<string, Record<string, string | Record<string, string>>> = {
  en: {
    appName: 'VrBroadcast',
    preAlpha: 'Pre-alpha',
    logoAlt: 'Nyades logo',
    streamToVRChat: 'Stream to VRChat',
    shareYour: 'Share your {mode} in virtual reality',
    shareYourCamera: 'Share your camera in virtual reality',
    shareYourScreen: 'Share your screen in virtual reality',
    startBroadcast: 'Start Broadcast',
    stopBroadcast: 'Stop Broadcast',
    startScreencast: 'Start Screencast',
    stopScreencast: 'Stop Screencast',
    ready: 'Ready',
    streaming: 'Streaming',
    error: 'Error',
    viewers: 'Viewers',
    quality: 'Quality',
    latency: 'Latency',
    rtmpStreamLink: 'RTMP Stream Link',
    copy: 'Copy',
    copied: 'Copied!',
    loading: 'Loading...',
    donate: {
      supportNyades: 'Support Nyades',
      chooseMethod: 'Choose your preferred donation method',
      creditCardAlt: 'Credit Card',
      visaMastercard: 'Visa & Mastercard',
      mirCardAlt: 'MIR Card',
      paymentCard: 'Payment Card',
      mirCard: 'MIR Card',
      paymentCardMir: 'Payment Card (MIR)',
      sbpAlt: 'SBP QR',
      sbpTitle: 'SBP (Fast Payment System)',
      sbpDesc: 'Pay via SBP QR',
      kofiAlt: 'Ko-fi',
      paypal: 'PayPal',
      supportViaPaypal: 'Support via PayPal',
      wechatAlt: 'WeChat Pay',
      wechatPay: 'WeChat Pay',
      wechatPayZh: '微信支付',
      wechatQrAlt: 'WeChat QR code',
      alipayAlt: 'Alipay',
      alipay: 'Alipay',
      alipayZh: '支付宝',
      alipayQrAlt: 'Alipay QR code',
      sbpQrAlt: 'SBP QR code',
      donationAlertsAlt: 'DonationAlerts',
      donationAlerts: 'DonationAlerts',
      donationAlertsDesc: 'Support via DonationAlerts',
      thankYou: 'Thank you for your support!'
    },
    contactMe: 'Contact Me',
    getInTouch: 'Get in touch with Nyades',
    name: 'Name',
    email: 'Email',
    message: 'Message',
    send: 'Send',
    joinDiscord: 'Join our Discord',
    close: 'Close',
    ok: 'OK',
    donateBtn: 'Donate',
    realtimeFileSharing: 'Realtime File Sharing',
    pro: 'PRO',
    proPopupText: '1080p streaming is available in the PRO version.',
    startIconAlt: 'Start icon',
    stopIconAlt: 'Stop icon',
  },
  ru: {
    appName: 'VrBroadcast',
    preAlpha: 'Пре-альфа',
    logoAlt: 'Логотип Nyades',
    streamToVRChat: 'Трансляция в VRChat',
    shareYour: 'Делитесь своим {mode} в виртуальной реальности',
    shareYourCamera: 'Делитесь своей камерой в виртуальной реальности',
    shareYourScreen: 'Делитесь своим экраном в виртуальной реальности',
    startBroadcast: 'Начать трансляцию',
    stopBroadcast: 'Остановить трансляцию',
    startScreencast: 'Начать трансляцию',
    stopScreencast: 'Остановить трансляцию',
    ready: 'Готово',
    streaming: 'В эфире',
    error: 'Ошибка',
    viewers: 'Зрители',
    quality: 'Качество',
    latency: 'Задержка',
    rtmpStreamLink: 'Ссылка на RTMP поток',
    copy: 'Копировать',
    copied: 'Скопировано!',
    loading: 'Загрузка...',
    donatebtn: 'Поддержать',
    donate: {
      supportNyades: 'Поддержать Nyades',
      chooseMethod: 'Выберите способ поддержки',
      creditCardAlt: 'Банковская карта',
      visaMastercard: 'Visa и Mastercard',
      mirCardAlt: 'Карта МИР',
      paymentCard: 'Банковская карта',
      mirCard: 'Банковская карта МИР',
      paymentCardMir: 'Российская платёжная система',
      sbpAlt: 'СБП QR',
      sbpTitle: 'СБП (Система быстрых платежей)',
      sbpDesc: 'Оплата через СБП QR',
      kofiAlt: 'Ko-fi',
      paypal: 'PayPal',
      supportViaPaypal: 'Поддержать через PayPal',
      wechatAlt: 'WeChat Pay',
      wechatPay: 'WeChat Pay',
      wechatPayZh: '微信支付',
      wechatQrAlt: 'QR-код WeChat',
      alipayAlt: 'Alipay',
      alipay: 'Alipay',
      alipayZh: '支付宝',
      alipayQrAlt: 'QR-код Alipay',
      sbpQrAlt: 'QR-код СБП',
      donationAlertsAlt: 'DonationAlerts',
      donationAlerts: 'DonationAlerts',
      donationAlertsDesc: 'Поддержать через DonationAlerts',
      thankYou: 'Спасибо за вашу поддержку!'
    },
    contactMe: 'Связаться со мной',
    getInTouch: 'Связь с Nyades',
    name: 'Имя',
    email: 'Почта',
    message: 'Сообщение',
    send: 'Отправить',
    joinDiscord: 'Присоединяйтесь к нашему Discord',
    close: 'Закрыть',
    ok: 'ОК',
    donateBtn: 'Поддержать',
    realtimeFileSharing: 'Обмен файлами в реальном времени',
    pro: 'ПРО',
    proPopupText: 'Трансляция в 1080p доступна в версии ПРО.',
    startIconAlt: 'Иконка старта',
    stopIconAlt: 'Иконка остановки',
  },
  zh: {
    appName: 'VrBroadcast',
    preAlpha: '预览版',
    logoAlt: 'Nyades标志',
    streamToVRChat: '传输到VRChat',
    shareYour: '在虚拟现实中分享您的{mode}',
    shareYourCamera: '在虚拟现实中分享您的摄像头',
    shareYourScreen: '在虚拟现实中分享您的屏幕',
    startBroadcast: '开始直播',
    stopBroadcast: '停止直播',
    startScreencast: '开始屏幕共享',
    stopScreencast: '停止屏幕共享',
    ready: '就绪',
    streaming: '直播中',
    error: '错误',
    viewers: '观众',
    quality: '质量',
    latency: '延迟',
    rtmpStreamLink: 'RTMP流链接',
    copy: '复制',
    copied: '已复制！',
    loading: '加载中...',
    donate: {
      supportNyades: '支持Nyades',
      chooseMethod: '选择您喜欢的捐赠方式',
      creditCardAlt: '信用卡',
      visaMastercard: 'Visa和Mastercard',
      mirCardAlt: 'MIR卡',
      paymentCard: '支付卡',
      mirCard: 'MIR卡',
      paymentCardMir: '支付卡（MIR）',
      sbpAlt: 'SBP二维码',
      sbpTitle: 'SBP（快速支付系统）',
      sbpDesc: '通过SBP二维码支付',
      kofiAlt: 'Ko-fi',
      paypal: 'PayPal',
      supportViaPaypal: '通过PayPal支持',
      wechatAlt: '微信支付',
      wechatPay: '微信支付',
      wechatPayZh: '微信支付',
      wechatQrAlt: '微信二维码',
      alipayAlt: '支付宝',
      alipay: '支付宝',
      alipayZh: '支付宝',
      alipayQrAlt: '支付宝二维码',
      sbpQrAlt: 'SBP二维码',
      donationAlertsAlt: 'DonationAlerts',
      donationAlerts: 'DonationAlerts',
      donationAlertsDesc: '通过DonationAlerts支持',
      thankYou: '感谢您的支持！'
    },
    contactMe: '联系我',
    getInTouch: '联系Nyades',
    name: '姓名',
    email: '邮箱',
    message: '消息',
    send: '发送',
    joinDiscord: '加入我们的Discord',
    close: '关闭',
    ok: '确定',
    donateBtn: '捐赠',
    realtimeFileSharing: '实时文件共享',
    pro: '专业版',
    proPopupText: '1080p流媒体在专业版中可用。',
    startIconAlt: '开始图标',
    stopIconAlt: '停止图标'
  },
  ja: {
    appName: 'VrBroadcast',
    preAlpha: 'プレアルファ',
    logoAlt: 'Nyadesロゴ',
    streamToVRChat: 'VRChatにストリーム',
    shareYour: '仮想現実で{mode}を共有',
    shareYourCamera: '仮想現実でカメラを共有',
    shareYourScreen: '仮想現実で画面を共有',
    startBroadcast: '配信開始',
    stopBroadcast: '配信停止',
    startScreencast: '画面共有開始',
    stopScreencast: '画面共有停止',
    ready: '準備完了',
    streaming: '配信中',
    error: 'エラー',
    viewers: '視聴者',
    quality: '品質',
    latency: '遅延',
    rtmpStreamLink: 'RTMPストリームリンク',
    copy: 'コピー',
    copied: 'コピーしました！',
    loading: '読み込み中...',
    donate: {
      supportNyades: 'Nyadesを支援',
      chooseMethod: '支援方法を選択してください',
      creditCardAlt: 'クレジットカード',
      visaMastercard: 'VisaとMastercard',
      mirCardAlt: 'MIRカード',
      paymentCard: '決済カード',
      mirCard: 'MIRカード',
      paymentCardMir: '決済カード（MIR）',
      sbpAlt: 'SBP QR',
      sbpTitle: 'SBP（高速決済システム）',
      sbpDesc: 'SBP QRで支払い',
      kofiAlt: 'Ko-fi',
      paypal: 'PayPal',
      supportViaPaypal: 'PayPalで支援',
      wechatAlt: 'WeChat Pay',
      wechatPay: 'WeChat Pay',
      wechatPayZh: '微信支付',
      wechatQrAlt: 'WeChatQRコード',
      alipayAlt: 'Alipay',
      alipay: 'Alipay',
      alipayZh: '支付宝',
      alipayQrAlt: 'AlipayQRコード',
      sbpQrAlt: 'SBP QRコード',
      donationAlertsAlt: 'DonationAlerts',
      donationAlerts: 'DonationAlerts',
      donationAlertsDesc: 'DonationAlertsで支援',
      thankYou: 'ご支援ありがとうございます！'
    },
    contactMe: 'お問い合わせ',
    getInTouch: 'Nyadesに連絡',
    name: '名前',
    email: 'メール',
    message: 'メッセージ',
    send: '送信',
    joinDiscord: 'Discordに参加',
    close: '閉じる',
    ok: 'OK',
    donateBtn: '寄付',
    realtimeFileSharing: 'リアルタイムファイル共有',
    pro: 'プロ',
    proPopupText: '1080pストリーミングはプロバージョンで利用可能です。',
    startIconAlt: '開始アイコン',
    stopIconAlt: '停止アイコン'
  }
};

const initialLocale = localStorage.getItem('locale') || getPreferredLocale('en');

const state = reactive({
  locale: initialLocale,
});

export function t(key: string, params?: Record<string, string | number>) {
  // Support dot notation for nested keys
  function getNested(obj: any, path: string[]): any {
    return path.reduce((acc, k) => (acc && acc[k] !== undefined ? acc[k] : undefined), obj);
  }
  const path = key.split('.');
  let str = getNested(messages[state.locale], path) || getNested(messages['en'], path) || key;
  if (typeof str !== 'string') str = key;
  if (params) {
    Object.entries(params).forEach(([k, v]) => {
      str = str.replace(`{${k}}`, String(v));
    });
  }
  return str;
}

export function setLocale(locale: string) {
  state.locale = locale;
  localStorage.setItem('locale', locale);
}

export function getLocale() {
  return state.locale;
}

export default { t, setLocale, getLocale, state };
